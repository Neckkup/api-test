<div style="max-width: 700px; margin: 30px auto; font-family: 'Segoe UI', Tahoma, sans-serif; padding: 30px; border-radius: 16px; background: white; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 1px solid #f0f0f0;">
    
    <div style="text-align:center; margin-bottom:25px;">
        <h2 style="margin:0; color:#1a73e8;">üìö NotebookLM Manager</h2>
        <p style="color:#666; font-size:14px;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏∏‡∏î‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£ (Enterprise Edition)</p>
    </div>

    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 25px; border: 1px solid #e9ecef;">
        <label style="font-weight:bold; color:#444;">üîë Google Access Token</label>
        <input type="text" id="access-token" placeholder="‡∏ß‡∏≤‡∏á Token ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å gcloud auth print-access-token" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:6px; margin-top:5px; font-family:monospace; color:#333;">
    </div>

    <div style="margin-bottom: 30px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <label style="font-weight:bold; color:#444;">üìã ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏∏‡∏î‡∏á‡∏≤‡∏ô</label>
            <button type="button" onclick="listNotebooks()" style="background:#1a73e8; color:white; border:none; padding:6px 15px; border-radius:20px; cursor:pointer; font-size:13px; font-weight:bold;">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
        </div>
        <div id="notebook-list-box" style="height: 180px; overflow-y: auto; background: #fff; border: 1px solid #ddd; border-radius: 8px;">
            <p style="text-align:center; color:#999; margin-top:70px;">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
        </div>
    </div>

    <hr style="border:0; border-top:1px dashed #ddd; margin: 25px 0;">

    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
        
        <div style="background:#fff; border:1px solid #eee; padding:15px; border-radius:8px;">
            <label style="font-weight:bold; font-size:14px; color:#1a73e8;">‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏°‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà</label>
            <input type="text" id="nb-title" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏∏‡∏î..." style="width:100%; padding:8px; border:1px solid #ccc; border-radius:6px; margin:10px 0;">
            <button type="button" onclick="createNotebook()" style="width:100%; padding:8px; background:#1a73e8; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:bold;">‡∏™‡∏£‡πâ‡∏≤‡∏á</button>
            <div id="create-result" style="font-size:12px; margin-top:5px;"></div>
        </div>

        <div style="background:#fff; border:1px solid #eee; padding:15px; border-radius:8px;">
            <label style="font-weight:bold; font-size:14px; color:#34a853;">üì• ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏°‡∏∏‡∏î</label>
            
            <input type="text" id="target-nb-id" placeholder="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô" style="width:100%; padding:8px; background:#f1f3f4; border:1px solid #ddd; border-radius:6px; margin:10px 0; font-family:monospace; color:#333;" readonly>

            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <button onclick="switchTab('pdf')" id="tab-pdf" style="flex:1; padding:5px; cursor:pointer; background:#34a853; color:white; border:none; border-radius:4px;">üìÑ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î PDF</button>
                <button onclick="switchTab('text')" id="tab-text" style="flex:1; padding:5px; cursor:pointer; background:#eee; color:#555; border:none; border-radius:4px;">üìù ‡πÅ‡∏õ‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
            </div>

            <div id="content-pdf">
                <input type="file" id="file-input" accept="application/pdf" style="font-size:12px; width:100%; margin-bottom:8px;">
                <button type="button" onclick="uploadFile()" id="btn-upload" style="width:100%; padding:8px; background:#34a853; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:bold;">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå</button>
            </div>

            <div id="content-text" style="display:none;">
                <input type="text" id="text-title" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á..." style="width:100%; padding:5px; border:1px solid #ddd; border-radius:4px; margin-bottom:5px;">
                <textarea id="text-body" rows="3" placeholder="‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..." style="width:100%; padding:5px; border:1px solid #ddd; border-radius:4px; margin-bottom:5px; font-family:sans-serif;"></textarea>
                <button type="button" onclick="addTextSource()" id="btn-text" style="width:100%; padding:8px; background:#fbbc04; color:black; border:none; border-radius:6px; cursor:pointer; font-weight:bold;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
            </div>

            <div id="upload-result" style="font-size:12px; margin-top:5px;"></div>
        </div>
    </div>

    <div id="link-container" style="display:none; margin-top:20px; text-align:center; background:#e6f4ea; padding:15px; border-radius:8px; border:1px dashed #34a853;">
        <h4 style="margin:0 0 5px 0; color:#137333;">‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h4>
        <a id="real-notebook-link" href="#" target="_blank" style="text-decoration:none; color:#1a73e8; font-weight:bold; font-size:14px;">üí¨ ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡∏™‡∏°‡∏∏‡∏î‡πÄ‡∏•‡πà‡∏°‡∏ô‡∏µ‡πâ</a>
    </div>

</div>

<script>
    const CF_URL = "https://notebooklm-chat-api-291927098582.asia-southeast1.run.app"; 
    const PROJECT_ID = "291927098582"; // ‡πÉ‡∏™‡πà Project ID ‡πÑ‡∏ß‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

    // --- Tab Switcher ---
    function switchTab(mode) {
        document.getElementById('content-pdf').style.display = (mode === 'pdf') ? 'block' : 'none';
        document.getElementById('content-text').style.display = (mode === 'text') ? 'block' : 'none';
        
        // Update Button Styles
        document.getElementById('tab-pdf').style.background = (mode === 'pdf') ? '#34a853' : '#eee';
        document.getElementById('tab-pdf').style.color = (mode === 'pdf') ? 'white' : '#555';
        
        document.getElementById('tab-text').style.background = (mode === 'text') ? '#fbbc04' : '#eee';
        document.getElementById('tab-text').style.color = (mode === 'text') ? 'black' : '#555';
    }

    function getToken() {
        let t = document.getElementById('access-token').value;
        t = t.trim().replace(/[^\x00-\x7F]/g, ""); // Clean Token
        if(!t) { alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏á Token ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö"); return null; }
        return t;
    }

    async function listNotebooks() {
        const token = getToken(); if(!token) return;
        const box = document.getElementById('notebook-list-box');
        box.innerHTML = "<p style='text-align:center; margin-top:70px;'>‚è≥ Loading...</p>";
        try {
            const resp = await fetch(CF_URL, {
                method: 'POST',
                headers: {'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token},
                body: JSON.stringify({ action: 'list_notebooks' })
            });
            const data = await resp.json();
            if(data.status === 'success') {
                if(data.notebooks.length === 0) box.innerHTML = "<p style='text-align:center; margin-top:70px;'>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏°‡∏∏‡∏î</p>";
                else {
                    let html = '<ul style="list-style:none; padding:0; margin:0;">';
                    data.notebooks.forEach(nb => {
                        html += `
                        <li onclick="selectNotebook('${nb.id}')" style="padding:10px; border-bottom:1px solid #f0f0f0; display:flex; justify-content:space-between; cursor:pointer;">
                            <div><span style="font-weight:bold;">üìò ${nb.title}</span><br><span style="font-size:11px; color:#999;">ID: ...${nb.id.slice(-6)}</span></div>
                            <button onclick="deleteNotebook('${nb.id}', event)" style="background:#ffebee; color:red; border:none; padding:2px 8px; border-radius:4px; cursor:pointer;">üóëÔ∏è</button>
                        </li>`;
                    });
                    box.innerHTML = html + '</ul>';
                }
            } else { box.innerHTML = `<p style="color:red; text-align:center;">Error: ${data.message}</p>`; }
        } catch(e) { box.innerHTML = "Error: " + e; }
    }

    function selectNotebook(id) {
        const input = document.getElementById('target-nb-id');
        input.value = id;
        input.style.backgroundColor = "#e3f2fd";
        setTimeout(() => input.style.backgroundColor = "#f1f3f4", 500);
    }

    async function createNotebook() {
        const token = getToken(); if(!token) return;
        const title = document.getElementById('nb-title').value;
        if(!title) { alert("‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö"); return; }
        try {
            const resp = await fetch(CF_URL, {
                method: 'POST',
                headers: {'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token},
                body: JSON.stringify({ action: 'create_notebook', title: title })
            });
            const data = await resp.json();
            if(data.status === 'success') {
                selectNotebook(data.notebook_id);
                listNotebooks();
            } else { alert("Error: " + data.message); }
        } catch(e) { alert(e); }
    }

    async function deleteNotebook(id, event) {
        event.stopPropagation();
        if(!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö?")) return;
        const token = getToken(); if(!token) return;
        try {
            const resp = await fetch(CF_URL, {
                method: 'POST',
                headers: {'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token},
                body: JSON.stringify({ action: 'delete_notebook', notebook_id: id })
            });
            listNotebooks();
        } catch(e) { alert(e); }
    }

    async function uploadFile() {
        const token = getToken(); if(!token) return;
        const nbId = document.getElementById('target-nb-id').value;
        const fileInput = document.getElementById('file-input');
        if(!nbId || fileInput.files.length === 0) { alert("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö"); return; }
        
        const reader = new FileReader();
        reader.readAsDataURL(fileInput.files[0]);
        document.getElementById('upload-result').innerHTML = "‚è≥ Uploading PDF...";
        
        reader.onload = async function() {
            try {
                const resp = await fetch(CF_URL, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token},
                    body: JSON.stringify({ action: 'upload_file', notebook_id: nbId, file_data: reader.result.split(',')[1] })
                });
                const data = await resp.json();
                handleSuccess(data, nbId);
            } catch(e) { alert(e); }
        };
    }

    async function addTextSource() {
        const token = getToken(); if(!token) return;
        const nbId = document.getElementById('target-nb-id').value;
        const title = document.getElementById('text-title').value || "‡πÇ‡∏ô‡πâ‡∏ï‡πÉ‡∏´‡∏°‡πà";
        const content = document.getElementById('text-body').value;
        
        if(!nbId || !content) { alert("‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö"); return; }

        document.getElementById('upload-result').innerHTML = "‚è≥ Saving Text...";
        
        try {
            const resp = await fetch(CF_URL, {
                method: 'POST',
                headers: {'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token},
                body: JSON.stringify({ 
                    action: 'add_source_text', 
                    notebook_id: nbId, 
                    text_content: content,
                    source_title: title
                })
            });
            const data = await resp.json();
            handleSuccess(data, nbId);
        } catch(e) { alert(e); }
    }

    function handleSuccess(data, nbId) {
        const resDiv = document.getElementById('upload-result');
        if(data.status === 'success') {
            resDiv.innerHTML = `<span style="color:green;">‚úÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</span>`;
            document.getElementById('link-container').style.display = 'block';
            
            // [UPDATED] ‡πÉ‡∏ä‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Enterprise
            document.getElementById('real-notebook-link').href = `https://notebooklm.cloud.google.com/global/notebooks/${nbId}?project=${PROJECT_ID}`;
            
            // Clear inputs
            document.getElementById('file-input').value = "";
            document.getElementById('text-title').value = "";
            document.getElementById('text-body').value = "";
        } else {
            resDiv.innerHTML = `<span style="color:red;">Error: ${data.message}</span>`;
        }
    }
    
    // Bind global
    window.listNotebooks = listNotebooks;
    window.selectNotebook = selectNotebook;
    window.deleteNotebook = deleteNotebook;
    window.createNotebook = createNotebook;
    window.uploadFile = uploadFile;
    window.addTextSource = addTextSource;
    window.switchTab = switchTab;
</script>
