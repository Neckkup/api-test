<div style="max-width: 750px; margin: 30px auto; font-family: 'Segoe UI', Tahoma, sans-serif; padding: 30px; border-radius: 16px; background: white; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 1px solid #e0e0e0;">
    
    <div style="text-align:center; margin-bottom:25px;">
        <h2 style="margin:0; color:#1a73e8; font-size: 24px;">üìö NotebookLM Remote Console</h2>
        <p style="color:#666; font-size:14px;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏∏‡∏î & ‡∏™‡∏±‡πà‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢</p>
    </div>

    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 25px; border: 1px solid #e9ecef;">
        <label style="font-weight:bold; color:#444; font-size: 13px;">üîë Google Access Token</label>
        <input type="text" id="access-token" placeholder="‡∏ß‡∏≤‡∏á Token ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å gcloud auth print-access-token" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:6px; margin-top:5px; font-family:monospace; color:#333; font-size: 12px;">
    </div>

    <div style="margin-bottom: 30px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <label style="font-weight:bold; color:#444;">üìã ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏∏‡∏î‡∏á‡∏≤‡∏ô</label>
            <button type="button" onclick="listNotebooks()" style="background:#1a73e8; color:white; border:none; padding:6px 15px; border-radius:20px; cursor:pointer; font-size:13px; font-weight:bold; transition: 0.2s;">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
        </div>
        <div id="notebook-list-box" style="height: 160px; overflow-y: auto; background: #fff; border: 1px solid #ddd; border-radius: 8px; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);">
            <p style="text-align:center; color:#999; margin-top:60px; font-size: 13px;">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏∏‡∏î</p>
        </div>
    </div>

    <hr style="border:0; border-top:1px dashed #ddd; margin: 25px 0;">

    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
        
        <div style="background:#fff; border:1px solid #eee; padding:15px; border-radius:8px;">
            <label style="font-weight:bold; font-size:14px; color:#1a73e8;">‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏°‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà</label>
            <input type="text" id="nb-title" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏∏‡∏î..." style="width:100%; padding:8px; border:1px solid #ccc; border-radius:6px; margin:10px 0; font-size: 13px;">
            <button type="button" onclick="createNotebook()" style="width:100%; padding:8px; background:#1a73e8; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:bold; font-size: 13px;">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏°‡∏∏‡∏î</button>
        </div>

        <div style="background:#fff; border:1px solid #eee; padding:15px; border-radius:8px;">
            <label style="font-weight:bold; font-size:14px; color:#34a853;">üì• ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏°‡∏∏‡∏î</label>
            <input type="text" id="target-nb-id" placeholder="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô" style="width:100%; padding:8px; background:#f1f3f4; border:1px solid #ddd; border-radius:6px; margin:10px 0; font-family:monospace; color:#333; font-size: 11px;" readonly>
            
            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <button onclick="switchTab('pdf')" id="tab-pdf" class="tab-btn active-tab" style="flex:1;">PDF</button>
                <button onclick="switchTab('text')" id="tab-text" class="tab-btn" style="flex:1;">Text</button>
                <button onclick="switchTab('web')" id="tab-web" class="tab-btn" style="flex:1;">Web</button>
                <button onclick="switchTab('video')" id="tab-video" class="tab-btn" style="flex:1;">YT</button>
            </div>

            <div id="content-pdf" class="tab-content">
                <input type="file" id="file-input" accept="application/pdf" style="font-size:12px; width:100%; margin-bottom:8px;">
                <button type="button" onclick="uploadFile()" class="action-btn btn-green">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå PDF</button>
            </div>
            <div id="content-text" class="tab-content" style="display:none;">
                <input type="text" id="text-title" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠..." class="input-field">
                <textarea id="text-body" rows="3" placeholder="‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..." class="input-field"></textarea>
                <button type="button" onclick="addSource('text')" class="action-btn btn-yellow">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
            </div>
            <div id="content-web" class="tab-content" style="display:none;">
                <input type="text" id="web-title" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡πá‡∏ö..." class="input-field">
                <input type="text" id="web-url" placeholder="https://..." class="input-field">
                <button type="button" onclick="addSource('web')" class="action-btn btn-blue">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏ß‡πá‡∏ö</button>
            </div>
            <div id="content-video" class="tab-content" style="display:none;">
                <input type="text" id="video-url" placeholder="https://youtube.com/..." class="input-field">
                <button type="button" onclick="addSource('video')" class="action-btn btn-red">‡πÄ‡∏û‡∏¥‡πà‡∏° YouTube</button>
            </div>
            
            <div id="upload-result" style="font-size:12px; margin-top:8px; height: 16px;"></div>
        </div>
    </div>
    
    <div style="margin-top:25px; background:#fff; border:1px solid #ddd; border-radius:8px; padding:20px;">
        
        <div id="audio-control-panel" style="display:none;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <label style="font-weight:bold; font-size:15px; color:#555;">üéß ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢</label>
                <a id="google-link" href="#" target="_blank" style="text-decoration:none; color:#1a73e8; font-weight:bold; font-size:13px; border:1px solid #1a73e8; padding:5px 12px; border-radius:20px;">üîó ‡πÑ‡∏õ‡∏ü‡∏±‡∏á‡∏ó‡∏µ‡πà Google NotebookLM</a>
            </div>

            <div style="background:#f8f9fa; padding:15px; border-radius:8px; text-align:center; border:1px solid #eee;">
                <p id="audio-status" style="font-size:13px; color:#666; margin-top:0;">
                    ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á AI ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á (Podcast)
                </p>
                <div style="display:flex; gap:10px; justify-content:center; margin-top:10px;">
                    <button onclick="generateAudio()" style="background:#673ab7; color:white; border:none; padding:8px 20px; border-radius:20px; cursor:pointer; font-weight:bold; font-size:13px;">‚ú® ‡∏™‡∏±‡πà‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</button>
                    <button onclick="deleteAudio()" style="background:#fff; color:#d93025; border:1px solid #d93025; padding:8px 20px; border-radius:20px; cursor:pointer; font-weight:bold; font-size:13px;">üóëÔ∏è ‡∏•‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏î‡∏¥‡∏°</button>
                </div>
            </div>
        </div>

        <div style="margin-top:20px; border-top:1px solid #eee; padding-top:15px;">
             <div style="display:flex; justify-content:space-between; align-items:center;">
                <span style="font-size:13px; font-weight:bold; color:#777;">üìÑ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡∏™‡∏°‡∏∏‡∏î:</span>
                <button onclick="listSources()" style="font-size:12px; cursor:pointer; background:none; border:none; color:#1a73e8; font-weight:bold;">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
            </div>
            <div id="source-list-box" style="margin-top:10px; max-height:150px; overflow-y:auto;">
                <p style="text-align:center; color:#999; font-size:13px; margin-top:20px;">(‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏∏‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)</p>
            </div>
        </div>
    </div>

</div>

<style>
    .input-field { width:100%; padding:6px; border:1px solid #ddd; border-radius:4px; margin-bottom:6px; box-sizing: border-box; font-size: 13px; }
    .action-btn { width:100%; padding:8px; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:bold; font-size: 13px; }
    .btn-green { background:#34a853; } .btn-yellow { background:#fbbc04; color:black; } 
    .btn-blue { background:#4285f4; } .btn-red { background:#ea4335; }
    .source-item { padding:8px; border-bottom:1px solid #f0f0f0; display:flex; justify-content:space-between; align-items:center; font-size:13px; }
    .tab-btn { background:#eee; color:#555; border:none; border-radius:4px; padding:5px; cursor:pointer; font-size:12px; }
    .active-tab { background:#333; color:white; }
</style>

<script>
    // --- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ---
    const CF_URL = "https://notebooklm-chat-api-291927098582.asia-southeast1.run.app"; 
    const PROJECT_ID = "291927098582";
    // -------------

    function getToken() {
        let t = document.getElementById('access-token').value.trim().replace(/[^\x00-\x7F]/g, ""); 
        if(!t) { alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏á Token ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö"); return null; }
        return t;
    }

    // --- Tab Management ---
    function switchTab(mode) {
        document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.tab-btn').forEach(el => {
            el.style.backgroundColor = '#eee'; el.style.color = '#555';
        });
        document.getElementById('content-'+mode).style.display = 'block';
        let activeBtn = document.getElementById('tab-'+mode);
        if(mode === 'pdf') activeBtn.style.backgroundColor = '#34a853';
        else if(mode === 'text') activeBtn.style.backgroundColor = '#fbbc04';
        else if(mode === 'web') activeBtn.style.backgroundColor = '#4285f4';
        else if(mode === 'video') activeBtn.style.backgroundColor = '#ea4335';
        
        if(mode === 'text') activeBtn.style.color = 'black';
        else activeBtn.style.color = 'white';
    }

    // --- Core Functions ---
    async function listNotebooks() {
        const token = getToken(); if(!token) return;
        const box = document.getElementById('notebook-list-box');
        box.innerHTML = "<p style='text-align:center; margin-top:50px;'>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>";
        try {
            const resp = await fetch(CF_URL, { method: 'POST', headers: {'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token}, body: JSON.stringify({ action: 'list_notebooks' }) });
            const data = await resp.json();
            if(data.status === 'success') {
                if(data.notebooks.length === 0) box.innerHTML = "<p style='text-align:center; margin-top:50px;'>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏°‡∏∏‡∏î‡∏á‡∏≤‡∏ô</p>";
                else {
                    let html = '<ul style="list-style:none; padding:0; margin:0;">';
                    data.notebooks.forEach(nb => {
                        html += `<li onclick="selectNotebook('${nb.id}')" style="padding:12px; border-bottom:1px solid #f0f0f0; display:flex; justify-content:space-between; cursor:pointer; transition:0.2s;" onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='white'">
                            <div><span style="font-weight:bold; color:#333;">üìò ${nb.title}</span><br><span style="font-size:11px; color:#999;">ID: ...${nb.id.slice(-6)}</span></div>
                            <button onclick="deleteNotebook('${nb.id}', event)" style="background:#ffebee; color:#c62828; border:none; padding:4px 10px; border-radius:4px; cursor:pointer; font-size:12px;">‡∏•‡∏ö</button></li>`;
                    });
                    box.innerHTML = html + '</ul>';
                }
            } else { box.innerHTML = `<p style="color:red; text-align:center; margin-top:20px;">Error: ${data.message}</p>`; }
        } catch(e) { box.innerHTML = "Error: " + e; }
    }

    function selectNotebook(id) {
        document.getElementById('target-nb-id').value = id;
        document.getElementById('audio-control-panel').style.display = 'block'; 
        document.getElementById('audio-status').innerHTML = "‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô (‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)";
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏õ Google
        const googleUrl = `https://notebooklm.cloud.google.com/global/notebooks/${id}?project=${PROJECT_ID}`;
        document.getElementById('google-link').href = googleUrl;

        listSources(id);
    }

    async function generateAudio() {
        const token = getToken(); const nbId = document.getElementById('target-nb-id').value;
        if(!nbId) { alert("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö"); return; }
        
        const statusEl = document.getElementById('audio-status');
        statusEl.innerHTML = "<span style='color:#673ab7;'>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á... (‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà)</span>";
        
        try {
            const resp = await fetch(CF_URL, { method: 'POST', headers: {'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token}, body: JSON.stringify({ action: 'generate_audio', notebook_id: nbId }) });
            const data = await resp.json();
            if(data.status === 'success') {
                statusEl.innerHTML = "<span style='color:green; font-weight:bold;'>‚úÖ ‡∏™‡∏±‡πà‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!</span><br><span style='font-size:12px;'>‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•... ‡∏Å‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå '‡πÑ‡∏õ‡∏ü‡∏±‡∏á‡∏ó‡∏µ‡πà Google' ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏ú‡∏•</span>";
            } else {
                statusEl.innerHTML = `<span style='color:red;'>Error: ${data.message}</span>`;
            }
        } catch(e) { alert(e); }
    }

    async function deleteAudio() {
        if(!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?")) return;
        const token = getToken(); const nbId = document.getElementById('target-nb-id').value;
        const statusEl = document.getElementById('audio-status');
        statusEl.innerHTML = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...";
        
        try {
            const resp = await fetch(CF_URL, { method: 'POST', headers: {'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token}, body: JSON.stringify({ action: 'delete_audio', notebook_id: nbId }) });
            const data = await resp.json();
            if(data.status === 'success') {
                statusEl.innerHTML = "üóëÔ∏è ‡∏•‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î '‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà' ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢";
            } else {
                statusEl.innerHTML = `<span style='color:red;'>‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${data.message}</span>`;
            }
        } catch(e) { alert(e); }
    }

    // --- Helper Functions (Source & Notebook Management) ---
    async function listSources(nbId=null) { const token=getToken(); const targetId=nbId||document.getElementById('target-nb-id').value; if(!targetId)return; const box=document.getElementById('source-list-box'); box.innerHTML="<p style='text-align:center; color:#666;'>‚è≥...</p>"; try{ const resp=await fetch(CF_URL,{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify({action:'list_sources',notebook_id:targetId})}); const data=await resp.json(); if(data.status==='success'){ if(data.sources.length===0)box.innerHTML="<p style='text-align:center;color:#999;font-size:12px;margin-top:20px;'>‡∏™‡∏°‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</p>"; else{ let html=''; data.sources.forEach(src=>{ let i='üìÑ';if(src.type==='YouTube')i='‚ñ∂Ô∏è';if(src.type==='Web')i='üîó'; html+=`<div class="source-item"><div>${i} <b>${src.title}</b></div><button onclick="deleteSource('${src.id}','${src.title}')" style="color:red;border:1px solid #ffcdd2;background:#ffebee;border-radius:4px;cursor:pointer;font-size:10px;">‡∏•‡∏ö</button></div>`; }); box.innerHTML=html; } } }catch(e){box.innerHTML="Error:"+e;} }
    async function deleteSource(sid,t){ if(!confirm(`‡∏•‡∏ö ${t}?`))return; const token=getToken(); const nid=document.getElementById('target-nb-id').value; await fetch(CF_URL,{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify({action:'delete_source',notebook_id:nid,source_id:sid})}); listSources(nid); }
    async function createNotebook(){ const token=getToken(); const t=document.getElementById('nb-title').value; if(!t)return; const resp=await fetch(CF_URL,{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify({action:'create_notebook',title:t})}); const d=await resp.json(); if(d.status==='success'){selectNotebook(d.notebook_id);listNotebooks();} }
    async function deleteNotebook(id,e){ e.stopPropagation(); if(!confirm("‡∏•‡∏ö‡∏™‡∏°‡∏∏‡∏î?"))return; const token=getToken(); await fetch(CF_URL,{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify({action:'delete_notebook',notebook_id:id})}); listNotebooks(); }
    async function uploadFile(){ const token=getToken(); const nid=document.getElementById('target-nb-id').value; const f=document.getElementById('file-input'); if(!nid||!f.files[0])return; const r=new FileReader(); r.readAsDataURL(f.files[0]); document.getElementById('upload-result').innerHTML="‚è≥..."; r.onload=async function(){ await fetch(CF_URL,{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify({action:'upload_file',notebook_id:nid,file_data:r.result.split(',')[1]})}); handleSuccess({status:'success'},nid); }; }
    async function addSource(type){ const token=getToken(); const nid=document.getElementById('target-nb-id').value; let c="",t="Untitled"; if(type==='text'){t=document.getElementById('text-title').value;c=document.getElementById('text-body').value;} else if(type==='web'){t=document.getElementById('web-title').value;c=document.getElementById('web-url').value;} else if(type==='video'){c=document.getElementById('video-url').value;} if(!c)return; document.getElementById('upload-result').innerHTML="‚è≥..."; await fetch(CF_URL,{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify({action:'add_source',notebook_id:nid,source_type:type,content:c,source_title:t})}); handleSuccess({status:'success'},nid); }
    function handleSuccess(d,nid){ if(d.status==='success'){ document.getElementById('upload-result').innerHTML="<span style='color:green;'>‚úÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</span>"; listSources(nid); document.getElementById('file-input').value=""; document.getElementById('text-body').value=""; document.getElementById('web-url').value=""; document.getElementById('video-url').value=""; } else { document.getElementById('upload-result').innerHTML = `<span style='color:red;'>Error: ${d.message}</span>`; } }

    // Expose functions to window
    window.listNotebooks=listNotebooks; window.selectNotebook=selectNotebook; window.deleteNotebook=deleteNotebook; window.createNotebook=createNotebook; window.uploadFile=uploadFile; window.addSource=addSource; window.switchTab=switchTab; window.listSources=listSources; window.deleteSource=deleteSource; window.generateAudio=generateAudio; window.deleteAudio=deleteAudio;
</script>
